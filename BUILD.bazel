load("@aspect_rules_ts//ts:defs.bzl", "ts_config")

# -----------------------------------------------------------------------------
# Gazelle Configs
# -----------------------------------------------------------------------------
load("@gazelle//:defs.bzl", "gazelle")

# gazelle:prefix github.com/publiclabel/monorepo
gazelle(name = "gazelle")
# -----------------------------------------------------------------------------
# Go
# -----------------------------------------------------------------------------

# gazelle:proto_plugin protoc-gen-go implementation golang:protobuf:protoc-gen-go
# gazelle:proto_plugin protoc-gen-go-grpc implementation grpc:grpc-go:protoc-gen-go-grpc

# gazelle:proto_rule proto_compile implementation stackb:rules_proto:proto_compile
# gazelle:proto_rule proto_compiled_sources implementation stackb:rules_proto:proto_compiled_sources
# gazelle:proto_rule proto_go_library implementation stackb:rules_proto:proto_go_library
# gazelle:proto_rule proto_go_library deps @org_golang_google_protobuf//reflect/protoreflect
# gazelle:proto_rule proto_go_library deps @org_golang_google_protobuf//runtime/protoimpl
# gazelle:proto_rule proto_go_library visibility //visibility:public

# gazelle:proto_language go plugin protoc-gen-go
# gazelle:proto_language go plugin protoc-gen-go-grpc
# gazelle:proto_language go rule proto_compile

# https://github.com/bazelbuild/rules_go/blob/eb03b81312c3d459fb1ffdb18da9aa122e649905/proto/core.rst#option-2-use-pre-generated-pb-go-files
#
# gazelle:go_generate_proto false

# -----------------------------------------------------------------------------
# Excludes
# -----------------------------------------------------------------------------
#
# gazelle:exclude bazel-out
# gazelle:exclude bazel-bin
# gazelle:exclude bazel-monorepo
# gazelle:exclude bazel-testlogs
# gazelle:exclude external
# gazelle:exclude bazel/go/scripts/lib
#
# -----------------------------------------------------------------------------
# Map Kinds
# -----------------------------------------------------------------------------
#
# gazelle:map_kind go_binary go_binary //bazel/go:exports.bzl
# gazelle:map_kind go_library go_library //bazel/go:exports.bzl
# gazelle:map_kind go_proto_library go_proto_library //bazel/go:exports.bzl
# gazelle:map_kind go_test go_test //bazel/go:exports.bzl
#
# gazelle:map_kind proto_library proto_library //bazel/protobuf:exports.bzl
#
# -----------------------------------------------------------------------------
# Resolves
# -----------------------------------------------------------------------------
# Gazelle generates go_proto_library + go_library rules both with the same
# importpath causing a matches multiple rules error.

# -----------------------------------------------------------------------------
# General Files
# -----------------------------------------------------------------------------

exports_files([
    ".swcrc",
    "tsconfig.json",
    "jest.config.ts",
    "package.json",
])

# -----------------------------------------------------------------------------
# JS Stuff
# -----------------------------------------------------------------------------

ts_config(
    name = "tsconfig_root",
    src = "tsconfig.json",
    visibility = [":__subpackages__"],
)

ts_config(
    name = "tsconfig_svelte",
    src = "tsconfig.svelte.json",
    visibility = [":__subpackages__"],
)

load("@npm//:defs.bzl", "npm_link_all_packages")

npm_link_all_packages(
    name = "node_modules",
)
